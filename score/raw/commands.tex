\newcommand{\blankspace}{\_\_\_\_\_\_\_\_}

% Performer letter is capped lowercase letter, except for when it's for all performers, when it becomes ALL.
% Maybe there's a nicer way to handle this?
\newcommand{\performerletter}[1]{%
  \ifthenelse{\equal{#1}{performers}}{ALL}{\MakeUppercase{#1}}%
}

% \newcommand{\musician}[1]{    \ifthenelse{ \equal{\speaker}{musician}    }{\textbf{M: #1}}{M: #1}}
% \newcommand{\primary}[1]{     \ifthenelse{ \equal{\speaker}{primary}     }{\textbf{P: #1}}{P: #1}}
% \newcommand{\secondaryone}[1]{\ifthenelse{ \equal{\speaker}{secondaryone}}{\textbf{S1: #1}}{S1: #1}}
% \newcommand{\secondarytwo}[1]{\ifthenelse{ \equal{\speaker}{secondarytwo}}{\textbf{S2: #1}}{S2: #1}}
% \newcommand{\secondarythr}[1]{\ifthenelse{ \equal{\speaker}{secondarythr}}{\textbf{S3: #1}}{S3: #1}}
% \newcommand{\tertiaryone}[1]{ \ifthenelse{ \equal{\speaker}{tertiaryone} }{\textbf{T1: #1}}{T1: #1}}
% \newcommand{\tertiarytwo}[1]{ \ifthenelse{ \equal{\speaker}{tertiarytwo} }{\textbf{T1: #1}}{T2: #1}}
% \newcommand{\tertiarythr}[1]{ \ifthenelse{ \equal{\speaker}{tertiarythr} }{\textbf{T1: #1}}{T3: #1}}

\newcommand{\speak}[2]{\ifthenelse{\equal{\speaker}{#1}}{\textbf{\performerletter{#1}: #2}}{\performerletter{#1}: #2}}

% \ifthenelse{\equal{\speaker}{musician}}{%
%   \newcommand{\directionboxweight}{5pt}
% }{%
%   \newcommand{\directionboxweight}{1pt}
% }

% Stage directions are in small caps.
\newcommand{\direction}[1]{[\textsc{\lowercase{#1}}]}

% Box formatting, so they have nice lines and are well padded
\setlength{\fboxsep}{1em}
\setlength{\fboxrule}{2pt}

% tsdirectionforall = Direction for All
\newcommand{\tsdirectionforall}[1]{\setlength{\fboxrule}{2pt}\vspace{0.3\baselineskip}\fbox{\parbox{0.9\textwidth}{\textbf{#1}}}\setlength{\fboxrule}{1pt}\vspace{0.3\baselineskip}}

% \newtoggle{thickbox}
% \ifstrequal{\speaker}{musician}{\toggletrue{thickbox}}{}

% For directions for all secondaries.
\newtoggle{secondary}
\ifthenelse{\equal{\speaker}{s1}}{\toggletrue{secondary}}{}
\ifthenelse{\equal{\speaker}{s2}}{\toggletrue{secondary}}{}
\ifthenelse{\equal{\speaker}{s3}}{\toggletrue{secondary}}{}

% For directions for all performers, where a box should be thick
% for everyone *except* the audience, and Q and R.
\newtoggle{performers}
\toggletrue{performers}
\ifthenelse{\equal{\speaker}{audience}}{\togglefalse{performers}}{}
\ifthenelse{\equal{\speaker}{q}}{\togglefalse{performers}}{}
\ifthenelse{\equal{\speaker}{r}}{\togglefalse{performers}}{}

\newtoggle{thickbox}

% directionbox
%\newcommand{\directionbox}[1]{\setlength{\fboxrule}{\directionboxweight{}}\vspace{0.5\baselineskip}\fbox{\parbox{\textwidth}{#1}}\setlength{\fboxrule}{1pt}\vspace{0.5\baselineskip}}
\newcommand{\directionbox}[2]{
  \ifthenelse{\equal{\speaker}{#1}}{\toggletrue{thickbox}}{\togglefalse{thickbox}}

  % If the direction is for secondary, toggle the thickbox on if the secondary toggle is set.
  \ifthenelse{\equal{secondary}{#1}}{%
      \iftoggle{secondary}%
          {\toggletrue{thickbox}}%
          {}%
      }{}

  % If the direction is for performers, toggle the thickbox on.
  \ifthenelse{\equal{performers}{#1}}%
    {\iftoggle{performers}{\toggletrue{thickbox}}{}}%
    {}

% \toggletrue{thick}
  % \ifthenelse{\equal{musician}{musician}{\toggletrue{thick}}{\togglefalse{thick}}}
  % \setlength{\fboxrule}{\ifthenelse{\equal{#1}{\speaker}}{5pt}{1pt}}%
  %\setlength{\fboxrule}{\ifthenelse{\equal{\speaker}{#1}}{5pt}{1pt}}%
  \setlength{\fboxrule}{\iftoggle{thickbox}{2pt}{1pt}}%
  \vspace{0.3\baselineskip}%
  \fbox{\parbox{0.9\textwidth}{\iftoggle{thickbox}{\textbf{\performerletter{#1}: #2}}{\performerletter{#1}: #2}}}%
  \setlength{\fboxrule}{1pt}%
  \vspace{0.3\baselineskip}
}

% tstechnical = Technical direction
\newcommand{\tstechnical}[1]{\dbox{\vspace{0.3\baselineskip}\parbox{0.9\textwidth}{\textit{#1}}}\vspace{0.3\baselineskip}}

\newcommand{\technicalbox}[2]{
  \ifthenelse{\equal{\speaker}{#1}}{\toggletrue{thickbox}}{\togglefalse{thickbox}}
  \vspace{0.3\baselineskip}
  \dbox{\parbox{0.9\textwidth}{
    \iftoggle{thickbox}{\textbf{\textit{\performerletter{#1}: #2}}}{\textit{\performerletter{#1}: #2}}}
  }
  \vspace{0.3\baselineskip}
}

\newcommand{\playanote}{\directionbox{m}{When the others have stopped, play a note.}}

\newcommand{\notewait}{\directionbox{p}{Wait until it is barely possible to hear the piano.}}

% \newcommand{\pronounce}[2]{«\dashuline{#2} #1»} % « »
\newcommand{\pronounce}[2]{#1 {\footnotesize «~#2~»}} % « » \dashuline{#2}

% Bib formatting
%
% This lets me use a {mybiblist} environment to list the bibliographies,
% which are then formatted to look Chicago style.
% Taken from https://tex.stackexchange.com/q/148801/13866
\newenvironment{mybiblist}{%
  % \fontsize{10}{12}\selectfont
  % \footnotesize
  \begin{list}{}{%
      \setlength{\itemindent}{-2em}%%'
      \setlength{\leftmargin}{2em}%%'
      \setlength{\itemsep}{0pt}%%'
      \setlength{\parsep}{\parskip}%%'
      \setlength{\topsep}{\parskip}%%'
    }%
    \setlength{\parindent}{-2em}%%
  \item[]
  }
  {\end{list}
}
